var rWizard=baseClass.extend({isBusy:!1,loginFailCount:0,dc_session:"",cfg:null,ds_promo:null,ds_inviteData:null,sessionData:null,findBizList:null,curIdx:0,lastRes:null,flag_phoneUsed:!1,accountMode:"create_account",b_isEdit:!1,b_isReq_stateProv:!1,b_isReq_postalCode:!1,b_loginDisabled:!1,flag_signUpStaff:!1,curStepID:"form_new_biz",ds_package:null,obj_pricing_data:null,init:function(){this.initConfig()},fnInit_pricingDataRequest:function(){var a=delegate(this,this.fnHandler_pricingDataResponse,[]);$.ajax({cache:!1,url:"/data/pricing.json",dataType:"json",success:a})},fnHandler_pricingDataResponse:function(a){void 0!==a&&null!==a&&(this.obj_pricing_data=a)},fnEvalUrlArgs:function(){var a=__loc__.urlParams;if(void 0!==a.use_email&&setTimeout(function(){$("#f2A_email").val((""+a.use_email).replace(/\s+/g,"+"))},200),void 0!==a.email&&void 0!==a.code&&(this.fnLoadFormContext("form_staff_new"),setTimeout(function(){__8trk__.signupPriority(0,"Invitation URL","email: "+a.email),__8trk__.mxpTrack("SU Invite"),void 0!==a.email&&$("#f1_inv_email").val((""+a.email).replace(/\s+/g,"+")),void 0!==a.code&&$("#f1_inv_code").val(a.code)},600)),void 0!==a.promo||void 0!==window.__rWis_promo){var b=a.promo||window.__rWis_promo;$("#f3_biz_promo").val(b),setTimeout(delegate(this,this.fnPromoCodeHandler,[!0]),600)}},prepareOnReady:function(){null!==__i18n__.supportedCountries?this.initOnReady():__i18n__.fnSetCallback_onCList(delegate(this,this.initOnReady,[]))},fnEval_postalRequirement:function(a){var b=__i18n__.fnEvalPostalRequirement_byCC(a);this.b_isReq_postalCode=b.isRequired,!0===b.hasPostal?$("#f3_postal_row").css("display",""):($("#f3_postal_row").css("display","none"),$("#f3_postal").val(""))},fnLocalizeForm:function(a){"US"==(""+a).toUpperCase()?window.overrideContentByBxLang("suv2_45","Zipcode"):window.revertContentByBxLang("suv2_45")},fnEventsInit:function(){$(".form_item *").on("transitionend",function(a){a.stopImmediatePropagation()}),$(".form_item").on("transitionend",function(){var a=$(this);a.css({position:"relative"}),setTimeout(function(){a.css({position:"static"})},0)})},initOnReady:function(){this.fnEventsInit(),__8trk__.signupPriority(0,"Signup Page Ready",__loc__.pathname),this.dc_session=dc.fnCreateSession(this.ns,["register","accLogin"]);var a=core.defLang;"por"!=a&&"spa"!=a&&"nld"!=a||(a="eng"),dc.s(this.dc_session,"_regWiz_fnReq_getSegmentData",[delegate(this,this.fnDataHandler_segments,[]),null,a]),$(".ux_input").on("focus",function(){$(this).attr("data-valid","true")}),$("#f3_biz_type").select2({allowClear:!1}),$("#f3_biz_type").on("change",function(){$("#f3_biz_type").attr("data-valid","true")}),$("#f3_stateprov").select2({allowClear:!1});var b=$("#f2A_country"),c=$("#f2B_country"),d=$("#f3_country"),e=__i18n__.fnGetSupportedCountryList(),f={allowClear:!1};b.select2(f),c.select2(f),d.select2(f);for(var g=0;g<e.length;g++)void 0!==e[g].id&&void 0!==e[g].text&&(b.append($("<option />").val(e[g].id).text(e[g].text)),c.append($("<option />").val(e[g].id).text(e[g].text)),d.append($("<option />").val(e[g].id).text(e[g].text)));!0===__i18n__.b_supportedCC?($("#f2A_country").select2("val",__i18n__.currentCC),$("#f2B_country").select2("val",__i18n__.currentCC),$("#f3_country").select2("val",__i18n__.currentCC)):($("#f2A_country").select2("val",0),$("#f2B_country").select2("val",0),$("#f3_country").select2("val",0)),$(window).on("unload",function(){__8trk__.signupPriority(1,"Leave Signup"," Step : "+rWiz.curStepID)}),$("#f1_email").change(function(a){rWiz.fnTrackInput("f1_email")}).blur(function(a){rWiz.fnEmailValidateOnBlur(a)}),$("#f1_pass").change(function(a){rWiz.fnTrackInput("f1_pass")}),$("#f1_inv_email").change(function(a){rWiz.fnTrackInput("f1_inv_email")}),$("#f1_inv_code").change(function(a){rWiz.fnTrackInput("f1_inv_code")}),$("#f2A_fname").change(function(a){rWiz.fnTrackInput("f2A_fname")}),$("#f2A_lname").change(function(a){rWiz.fnTrackInput("f2A_lname")}),$("#f2A_email").change(function(a){rWiz.fnTrackInput("f2A_email")}).blur(function(a){rWiz.fnEmailValidateOnBlur(a)}),$("#f2A_pass").change(function(a){rWiz.fnTrackInput("f2A_pass")}),$("#f2A_biz_phone").change(function(a){rWiz.fnTrackInput("f2A_biz_phone")}),$("#f2A_country").change(function(a){rWiz.fnLocalizeForm($(this).val()),rWiz.fnPhoneValidateOnChange("#f2A_country","#f2A_biz_phone"),rWiz.fnTrackInput("f2A_country")}),$("#f2B_email").change(function(a){rWiz.fnTrackInput("f2B_email")}).blur(function(a){rWiz.fnEmailValidateOnBlur(a)}),$("#f2B_pass").change(function(a){rWiz.fnTrackInput("f2B_pass")}),$("#f2B_biz_phone").change(function(a){rWiz.fnTrackInput("f2B_biz_phone")}),$("#f2B_country").change(function(a){rWiz.fnLocalizeForm($(this).val()),rWiz.fnPhoneValidateOnChange("#f2B_country","#f2B_biz_phone"),rWiz.fnTrackInput("f2B_country")}),$("#f3_biz_name").change(function(a){rWiz.fnTrackInput("f3_biz_name")}),$("#f3_biz_type").change(function(a){rWiz.fnTrackInput("f3_biz_type")}),$("#f3_biz_phone").change(function(a){rWiz.fnHook_verifyBizPhone(a),rWiz.fnTrackInput("f3_biz_phone")}),$("#f3_postal").change(function(a){rWiz.fnTrackInput("f3_postal")}).blur(function(a){setTimeout(delegate(rWiz,rWiz.fnPostalValidateOnChange,[!0]),500)}),$("#f3_addr1").change(function(a){rWiz.fnTrackInput("f3_addr1")}),$("#f3_addr2").change(function(a){rWiz.fnTrackInput("f3_addr2")}),$("#f3_city").change(function(a){rWiz.fnTrackInput("f3_city")}),$("#f3_stateprov").change(function(a){rWiz.fnTrackInput("f3_stateprov")}),$("#f3_biz_promo").change(function(a){rWiz.fnTrackInput("f3_biz_promo")}),$("#f3_biz_terms").change(function(a){rWiz.fnTrackInput("f3_biz_terms")}),$("#f2A_fname").keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&$("#f2A_lname").focus()}),$("#f2A_lname").keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&$("#f2A_email").focus()}),$("#f2A_email").keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&$("#f2A_pass").focus()}),$("#f2A_pass").keyup(delegate(this,this.fnHook_pwKeyPress,[]));var h=$("#f2A_biz_phone");h.keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&($("#f2A_biz_phone").blur(),window.onContinue())}),h.blur(function(a){rWiz.fnPhoneValidateOnChange("#f2A_country","#f2A_biz_phone")}),$("#f2B_email").keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&$("#f2B_pass").focus()}),$("#f2B_pass").keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&$("#f2B_biz_phone").focus()});var i=$("#f2B_biz_phone");i.keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&($("#f2B_biz_phone").blur(),window.onContinue())}),i.blur(function(a){rWiz.fnPhoneValidateOnChange("#f2B_country","#f2B_biz_phone")}),$("#f1_email").keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&$("#f1_pass").focus()}),$("#f1_pass").keyup(delegate(this,this.fnHook_pwKeyPress,[])),$("#f1_inv_email").keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&$("#f1_inv_code").focus()}),$("#f1_inv_code").keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&($("#f1_inv_code").blur(),window.onContinue())}),$("#f3_biz_name").keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&$("#f3_biz_type").select2("open")});var j=$("#f3_biz_phone");j.keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&$("#f3_postal").focus()}),j.blur(function(a){rWiz.fnPhoneValidateOnChange("#f3_country","#f3_biz_phone")}),$("#f3_postal").keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&$("#f3_addr1").focus()}),$("#f3_addr1").keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&$("#f3_addr2").focus()}),$("#f3_addr2").keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&$("#f3_city").focus()}),$("#f3_city").keypress(function(a){rWiz.fnxSetEditState(),13==a.which&&$("#f3_stateprov").select2("open")}),$("#f2A_email").blur(function(a){rWiz.fnLog_byType($(this))}),$("#f2B_email").blur(function(a){rWiz.fnLog_byType($(this))}),$("#f1_email").blur(function(a){rWiz.fnLog_byType($(this))}),$("#f3_country").on("change",function(a){rWiz.fnPostalValidateOnChange(!0),rWiz.fnPhoneValidateOnChange("#f3_country","#f3_biz_phone"),rWiz.fnHook_onChangeCountryF3(),rWiz.fnTrackInput("f3_country")}),this.fnEvalUrlArgs()},fnTrackInput:function(a){__8trk__.signupPriority(1,"Form Input Change","ID: "+a)},fnHook_onChangeCountryF3:function(){var a=$("#f3_country").val();this.fnUpdateForm_stateProv(a),$("#f2A_country").val(a),$("#f2B_country").val(a),this.fnLocalizeForm(a),this.fnEval_postalRequirement(a)},fnUpdateForm_stateProv:function(a,b){var c=void 0!==a?a:this.sessionData.country,d=void 0!==b?b:__geo__.region;if(!0===__i18n__.hasProvState_exception(c)){this.b_isReq_stateProv=!0;var e=__i18n__.fnGet_stateProvByCC(c);if(!1===e)return this.b_isReq_stateProv=!1,void $("#f3_stateProv_row").css("display","none");var f="suv2_49";"CA"==c&&(f="suv2_49a"),"US"==c&&(f="suv2_49b"),$("#f3_stateProv_label").empty().append(utlWrpSpanByBxLangClass(f,"fx_fnt_14"));var g=$("#f3_stateprov");g.empty();for(var h=!1,i=0;i<e.length;i++)void 0!==e[i].id&&void 0!==e[i].text&&(g.append($("<option />").val(e[i].id).text(e[i].text)),(""+d).toUpperCase()==(""+e[i].id).toUpperCase()&&(h=!0));h?g.select2("val",(""+d).toUpperCase()):g.select2("val",0),$("#f3_stateProv_row").css("display","block")}else this.b_isReq_stateProv=!1,$("#f3_stateProv_row").css("display","none")},test:function(){$(".form_item ").attr("data-active","false"),$("#form_biz_done").parent().attr("data-active","true")},fnxUpdatePrice:function(){},fnUpdate_packageToopTip:function(a){},fnGetUnitLabel:function(a){switch((""+a).toLowerCase()){case"appts":return utlWrpSpanByBxLang("regwiz_33");case"sms":return utlWrpSpanByBxLang("regwiz_34");case"staff":return utlWrpSpanByBxLang("regwiz_35");default:return utlWrpSpanByBxLang("regwiz_36")}},fnxSetEditState:function(){this.b_isEdit=!0},fnPhoneValidateOnChange:function(a,b){var c=$(b);if(""!==c.val()){var d=__i18n__.fnValidateFormatPhone(c.val(),$(a).val());!1!==d?c.val(d).attr("data-valid","true"):c.attr("data-valid","false")}},fnEmailValidateOnBlur:function(a){var b=$(a.target),c=b.val();""!==c&&!1===regex.email.test(c)?b.attr("data-valid","false"):b.attr("data-valid","true")},fnPostalValidateOnChange:function(a){var b=$("#f3_postal"),c=$("#f3_country");!0===a&&""===b.val()||(__i18n__.fnValidatePostalByCC(c.val(),(""+b.val()).trim())?b.attr("data-valid","true"):b.attr("data-valid","false"))},fnHook_verifyBizPhone:function(a){var b=$(a.target).val();if(null!==this.sessionData.country&&""!==b&&void 0!==b){var c=__i18n__.fnValidateFormatPhone(b,this.sessionData.country);!1!==c&&($("#f2A_biz_phone").val(c),$("#f2B_biz_phone").val(c),this.fnLookup_bizPhoneUsed(c,this.sessionData.country))}},fnHook_pwKeyPress:function(a){this.fnxSetEditState();var b=a.target;if(13==a.which)return"f2A_pass"==b.name&&$("#f2A_biz_phone").focus(),void("f1_pass"==b.name&&$("#f1_inv_email").focus());var c="none",d=$(b),e=d.val();e.length>=6&&(c="bad"),regex.password_min.test(e)&&(c="ok"),regex.password_ok.test(e)&&(c="good"),0===e.length&&(c="none"),d.attr("data-pw",c);var f="";switch(c){case"bad":f=utlWrpSpanByBxLangClass("suv2_13","pw_col_bad");break;case"ok":f=utlWrpSpanByBxLangClass("suv2_14","pw_col_ok");break;case"good":f=utlWrpSpanByBxLangClass("suv2_15","pw_col_good")}$(".pw_str_meter").empty().append(f)},fnx_changeCountry:function(a){$("#f3_stateprov").select2("val","",!1),$("#f3_stateprov option").remove(),$("#f3_stateprov").select2("data",null);var b=utlGetProvStateByCountryCode(a);b.sort(utlSortSelect2Label);var c=$("#f3_stateprov");c.empty();for(var d=0;d<b.length;d++)c.append($("<option />").val(b[d].id).text(b[d].text));var e="ZZ"!==__geo__.country?__geo__.country:"CA",f=""!==__geo__.region&&null!==__geo__.region?__geo__.region:"qc";e==a&&$("#f3_stateprov").select2("val",f.toUpperCase())},fnHardReset:function(){this.initConfig(),$("#f2A_fname").val("").attr("data-valid","true"),$("#f2A_lname").val("").attr("data-valid","true"),$("#f2A_email").val("").attr("data-valid","true"),$("#f2A_pass").val("").attr("data-pw","none").attr("data-valid","true"),$("#f2A_biz_phone").val("").attr("data-valid","true"),$("#f2B_email").val("").attr("data-valid","true"),$("#f2B_pass").val("").attr("data-valid","true"),$("#f2B_biz_phone").val("").attr("data-valid","true"),$("#f1_email").val("").attr("data-valid","true"),$("#f1_pass").val("").attr("data-pw","none").attr("data-valid","true"),$("#f1_inv_email").val("").attr("data-valid","true"),$("#f1_inv_code").val("").attr("data-valid","true"),$("#f3_biz_name").val("").attr("data-valid","true"),$("#f3_biz_phone").val("").attr("data-valid","true"),$("#f3_postal").val("").attr("data-valid","true"),$("#f3_addr1").val("").attr("data-valid","true"),$("#f3_addr2").val("").attr("data-valid","true"),$("#f3_city").val("").attr("data-valid","true"),$(".pw_str_meter").empty()},fnDataHandler_segments:function(){var a=dc.s(this.dc_session,"_regWiz_fnGetDataByObjectLabel",["dsList_segments"]),b=$("#f3_biz_type");b.append($("<option />").val("-1").text(utlBxLang("suv2_42")));for(var c=0;c<a.length;c++)b.append($("<option />").val(a[c].seg_id).text(a[c].name));b.select2()},fnDataHandler_packages:function(a){},fnRender_packages:function(a){},fnFormat_packageString:function(a){if(void 0===a)return"";if(void 0===a.tier||null===this.obj_pricing_data)return a.name||"";var b=this.obj_pricing_data,c=(""+a.tier).toLocaleLowerCase();if(void 0===b.plan_title[c])return a.name||"";core.fnGetLang_2char();var d=b.plan_title[c][core.fnGetLang_2char()]||b.plan_title[c].en,e="";return void 0!==b.plan_details[c]&&(e=this.fnGetPackagePro(b.plan_details[c])),""!==e&&(d+=" - "+e),void 0===d?a.name||"":_lng_evalMultiFormString(d)},fnGetPackagePro:function(a){var b=(""+this.sessionData.country).toUpperCase(),c=a[b]||a.ZZ;if(void 0===c||void 0===this.obj_pricing_data.labels)return"";if(void 0===c.sp_pro_num)return"";var d=c.sp_pro_num;if(void 0===this.obj_pricing_data.labels[d])return"";var e=this.obj_pricing_data.labels[d],f=e[core.fnGetLang_2char()]||e.en;return _lng_evalMultiFormString(f)},initConfig:function(){this.cfg={form_new_biz:{progress:0,formID:"form_new_biz",stepID:"step_new_biz",nextID:"form_biz_addr",cardID:"card_new_biz"},form_biz_login:{progress:1,formID:"form_biz_login",stepID:"step_biz_login",nextID:"form_biz_addr",cardID:"card_new_biz"},form_biz_addr:{progress:2,formID:"form_biz_addr",stepID:"step_biz_addr",nextID:"form_biz_done",cardID:"card_biz_addr"},form_biz_done:{progress:3,formID:"form_biz_done",stepID:"step_biz_done",nextID:null,cardID:null},form_staff_new:{progress:4,formID:"form_staff_new",stepID:"step_staff_new",nextID:"form_staff_done",cardID:"card_staff_new"},form_staff_done:{progress:5,formID:"form_staff_done",stepID:"step_staff_done",nextID:null,cardID:null}},this.sessionData={firstname:null,lastname:null,phone:null,email:null,password:null,biz_name:null,segment:null,seg_id:null,pczip:null,address:null,address_line2:null,city:null,provstate:null,country:null,progress:null,promocode:null,invite_email:null,personnel_code:null,progress_type:null,package_id:null}},fnGet_nextStep:function(a){if(null===a)return dc.serverLogV2("SIGNUP_FAILSAFE","LOG_DEBUG","signup.js","fnGet_nextStep","nextID is null abort"),null;if(void 0===this.cfg[a])return dc.serverLogV2("SIGNUP_FAILSAFE","LOG_DEBUG","signup.js","fnGet_nextStep","The config data set does not contain an entry for nextID ("+a+"). abort"),null;var b=this.cfg[a];return null===b.stepID?(dc.serverLogV2("SIGNUP_FAILSAFE","LOG_DEBUG","signup.js","fnGet_nextStep","The next panel object has a null stepID for nextID ("+a+"), abort"),null):b.stepID},fnGetActiveForm:function(){var a=$(".form_item[data-active=true] > div:first-child"),b=null;return a.length>0&&(b=a.attr("id")),b},fnReload_biz1:function(){if(!0===this.b_isEdit){var a=delegate(this,function(){this.b_isEdit=!1,this.fnReload_biz1()},[]);return void this.fnOnBeforeChange_notify(a)}this.b_isEdit=!1,"create_account"==this.accountMode?this.fnLoadFormContext("form_new_biz",!1):this.fnLoadFormContext("form_biz_login",!1),$("#mob_staff_invite_option").css("display","block"),$("#card_new_biz").attr("data-active","false"),$("#card_biz_addr").attr("data-active","false"),$("#btn_form_continue").empty().append(utlWrpSpanByBxLangClass("suv2_31","fx_fnt_16 tx_shad_2"))},fnReload_biz2:function(){this.fnLoadFormContext("form_biz_addr",!1),$("#mob_staff_invite_option").css("display","none"),$("#card_biz_addr").attr("data-active","false"),$("#btn_form_continue").empty().append(utlWrpSpanByBxLangClass("suv2_31","fx_fnt_16 tx_shad_2"))},fnReload_staff1:function(){this.fnLoadFormContext("form_staff_new",!1),$("#mob_staff_invite_option").css("display","block"),$("#card_staff_new").attr("data-active","false"),$("#btn_form_continue").empty().append(utlWrpSpanByBxLangClass("suv2_31","fx_fnt_16 tx_shad_2"))},fnOnBeforeChange_notify:function(a){core.fnShowGPopup({masterClass:"globalPopup",text:utlWrpSpanByBxLang("suv2_err_12"),btn1_text:utlWrpSpanByBxLang("com_button_01"),btn2_text:utlWrpSpanByBxLang("com_button_02"),btn1_callback:a})},fnOnBeforeLangChange:function(a){!0===this.b_isEdit?this.fnOnBeforeChange_notify(delegate(window,window.fnLangChangeContinue,[a])):window.fnLangChangeContinue(a)},fnLoadFormContext:function(a,b){if(!0===this.b_isEdit){var c=delegate(this,function(a,b){this.b_isEdit=!1,this.fnLoadFormContext(a,b)},[a,b]);return void this.fnOnBeforeChange_notify(c)}this.b_isEdit=!1;var d=void 0===b||b;if(!0!==this.isBusy){__8trk__.signupPriority(1,"Change Form View","ID: "+a);if(null!==this.cfg[a].stepID){this.curStepID=this.cfg[a].stepID;var e=this.cfg[this.fnGetActiveForm()].stepID;null!==e&&$("#"+e).attr("data-active","standby")}$(".form_item").attr("data-active","false"),setTimeout(delegate(this,this.fnInitSignupFlow,[a,d]),500)}},fnInitSignupFlow:function(a,b){switch(a){case"form_new_biz":this.fnInitForm_newBiz();break;case"form_biz_login":this.fnInitForm_newBizProfile();break;case"form_staff_new":this.fnInitForm_staffInvite()}!0===b&&this.fnHardReset();var c=this.cfg[a].stepID;null!==c&&($(".step_block").attr("data-active","false"),$("#"+c).attr("data-active","standby"),$("#mobile_"+c).attr("data-active","standby"),setTimeout(function(){$("#"+c).attr("data-active","true"),$("#mobile_"+c).attr("data-active","true")},250)),$("#"+a).parent().attr("data-active","true"),this.isBusy=!1},fnInitForm_newBiz:function(){$("#form_img").attr("src","/img/signup/business_plus.svg"),this.sessionData.progress_type="business creation",this.sessionData.progress=0},fnInitForm_newBizProfile:function(){$("#form_img").attr("src","/img/signup/business_plus.svg"),this.sessionData.progress_type="business creation",this.sessionData.progress=1},fnInitForm_staffInvite:function(){$("#form_img").attr("src","/img/signup/new_personnel.svg"),this.sessionData.progress_type="personnel sign-up",this.sessionData.progress=4},fnPromoCodeHandler:function(a){var b=$("#f3_biz_promo"),c=b.val()||!1;if(!1===c||""===c)return void b.attr("data-valid","false");!0===a?__8trk__.signupPriority(1,"URL Promo Code","Code: "+c):__8trk__.signupPriority(1,"Request Promo Code","Code: "+c),dc.s(this.dc_session,"_regWiz_fnReq_validatePromo",[c,delegate(this,this.fnReqSuccess_promo,[]),delegate(this,this.fnReqFail_promo,[])])},fnReqSuccess_promo:function(a){if(null===a)return this.fnReqFail_promo(),void dc.serverLogV2("SIGNUP_FAILSAFE","LOG_DEBUG","signup.js","fnReqSuccess_promo","Promo data response is null, abort.");if(!0===a.isExpired)return this.fnHandle_promoExpired(),void dc.serverLogV2("SIGNUP_FAILSAFE","LOG_DEBUG","signup.js","fnReqSuccess_promo","Promo reponse object status is expired, abort.");var b="";if(void 0!==a.expiresOn&&null!==a.expiresOn){var c=new Date;b=moment.utc(a.expiresOn);var d=b.local().toDate();if(c.getTime()>d.getTime())return this.fnHandle_promoExpired(),void dc.serverLogV2("SIGNUP_FAILSAFE","LOG_DEBUG","signup.js","fnReqSuccess_promo","Promo reponse object expiresOn datetime has failed compare with NOW datetime. Abort")}var e=$("#promo_code_space"),f=($("#f3_biz_promo"),$("#promo_details_box").find("span"));this.ds_promo=a,f.eq(0).empty().append(a.welcomeTitle),f.eq(1).empty().append(a.description),""!==b?f.eq(2).empty().append(utlBxLang("regwiz_40")+b.local().format("lll")):f.eq(2).empty().append(""),e.attr("data-active","true")},fnHandle_promoExpired:function(){core.fnShowGPopup({masterClass:"globalPopup",text:utlWrpSpanByBxLang("regwiz_39"),btn1_text:utlWrpSpanByBxLang("com_button_03")}),this.fnReqFail_promo()},fnEvalSelectedPackage:function(a){},fnRemove_promoCode:function(){__8trk__.signupPriority(1,"Promo Code Removed"),$("#promo_code_space").attr("data-active","false"),$("#f3_biz_promo").val(""),this.ds_promo=null},fnReqFail_promo:function(){__8trk__.signupPriority(1,"Request Promo Code","Code Invalid"),this.ds_promo=null,$("#f3_biz_promo").attr("data-valid","false"),$("#promo_code_space").attr("data-active","false")},fnVerifyStaffInvite:function(a,b){var c={email:utlTrimWhiteSpace_edge(a,!0),code:b};dc.s(this.dc_session,"_regWiz_fnReq_staffInviteValidation",[c,delegate(this,this.fnReqSuccess_staffInvite,[]),delegate(this,this.fnReqFail_staffInvite,[])])},fnReqSuccess_staffInvite:function(a){this.ds_inviteData={invite_id:a.invite_id||"",merchant:a.merchant||"",inviter:a.inviter||""},this.lastRes.valid=!0;var b=this.lastRes;this.lastRes=null,this.fnProcessCurrentForm_partII(b)},fnReqFail_staffInvite:function(){this.isBusy=!1,this.lastRes=null,__8trk__.signupPriority(1,"Invitation Verification","Invitation not valid"),$("#f1_inv_email").attr("data-valid","false"),$("#f1_inv_code").attr("data-valid","false"),this.fnTriggerPopup_bxLang("suv2_err_01","suv2_err_02")},fnLookupBizMatch:function(a){if(void 0===a||null===a||null===this.sessionData.country)return this.lastRes.searchComplete=!0,this.lastRes.valid=!0,void this.fnResume_processCurrentForm();var b=__i18n__.fnValidateFormatPhone(a,this.sessionData.country);if(!1!==b){var c=formatE164(this.sessionData.country,b);dc.s(this.dc_session,"_regWiz_fnReq_getBusinessMatches",[c,this.sessionData.country,delegate(this,this.fnReqSuccess_bizLookup,[]),delegate(this,this.fnReqFail_bizLookup,[])])}},fnLookup_emailUsed:function(a){var b=utlTrimWhiteSpace_edge(a,!0);dc.s(this.dc_session,"_regWiz_fnReq_verifyEmailUse",[{email:b},delegate(this,this.fnReqSuccess_emailUsed,[])])},fnLookup_bizPhoneUsed:function(a,b){if(void 0!==a&&""!==a){var c=__i18n__.fnValidateFormatPhone(a,b);if(!1!==c){var d=formatE164(b,c);dc.s(this.dc_session,"_regWiz_fnReq_verifyPhoneUse",[{phone:d},delegate(this,this.fnReqSuccess_bizPhoneUsed,[])])}}},fnReqSuccess_emailUsed:function(a){if(!0!==a)return this.lastRes.valid=!0,void this.fnResume_processCurrentForm();core.fnShowGPopup({masterClass:"globalPopup",text:utlWrpSpanByBxLang("suv2_err_13"),btn1_text:utlWrpSpanByBxLang("com_button_03"),btn1_callback:delegate(this,this.fnHandler_existingAccount,[])})},fnHandler_existingAccount:function(){var a=this.lastRes;this.lastRes=null,this.b_isEdit=!1,this.isBusy=!1,__8trk__.signupPriority(1,"Email Lookup","Existing Account"),this.fnLoadFormContext("form_biz_login",!1),setTimeout(function(){$("#f2B_email").val(a.f2A_email),$("#f2B_pass").val(a.f2A_pass),!1!==a.f2A_biz_phone&&$("#f2B_biz_phone").val(a.f2A_biz_phone);var b=a.f2A_country;__i18n__.fnVerifyCC_isSupported(b)&&$("#f2B_country").select2("val",b)},600)},fnReqSuccess_bizPhoneUsed:function(a){this.flag_phoneUsed=a,__8trk__.signupPriority(1,"Number Lookup","Number Used");var b=!0===this.flag_phoneUsed?"true":"false";$("#biz_phone_notice").attr("data-active",b)},fnFilter_bizMatchList:function(a){for(var b=[],c=0;c<a.length;c++)utlNeutralizeString(a[c].country_code)==utlNeutralizeString(this.sessionData.country)&&b.push(a[c]);return b},fnReqSuccess_bizLookup:function(a){this.findBizList=this.fnFilter_bizMatchList(a),this.fnPreUpdate_bizAddrForm(),this.lastRes.searchComplete=!0,this.lastRes.valid=!0,this.fnResume_processCurrentForm()},fnReqFail_bizLookup:function(a){this.lastRes.searchComplete=!0,this.lastRes.valid=!0,this.fnResume_processCurrentForm()},fnVerifyLogin:function(a,b){var c={login:utlTrimWhiteSpace_edge(a,!0),password:b};dc.s(this.dc_session,"_acclog_fnRequest_performLogin",[c,delegate(this,this.fnReqSuccess_verifyLogin,[]),delegate(this,this.fnReqFail_verifyLogin,[])])},fnDebug:function(){dc.s_status(this.dc_session),dc.s_debug(this.dc_session)},fnShowLoginFailureMessage:function(a){switch(a){case 1:this.fnTriggerPopup_bxLang("suv2_err_03","suv2_err_04");break;case 2:this.fnTriggerPopup_bxLang("suv2_err_03","suv2_err_15");break;case 3:this.fnTriggerPopup_bxLang("suv2_err_03","suv2_err_16");break;case 4:this.fnTriggerPopup_bxLang("suv2_err_03","suv2_err_14");break;default:this.fnTriggerPopup_bxLang("suv2_err_03","suv2_err_04")}},fnReqSuccess_verifyLogin:function(a){if(void 0!==a.refused_reason){var b=parseInt(a.refused_reason,10);return this.lastRes=null,this.isBusy=!1,$("#f2B_email").attr("data-valid","false"),$("#f2B_pass").attr("data-valid","false"),1===b&&(__8trk__.signupPriority(1,"Login Failed","Fail Count",this.loginFailCount),++this.loginFailCount>3&&!1===this.b_loginDisabled&&(__8trk__.signupPriority(1,"Login Failed","Account Locked"),dc.s(this.dc_session,"_acclog_fnRequest_lockout",[{login:utlTrimWhiteSpace_edge(this.sessionData.email,!0)}]),this.b_loginDisabled=!0)),void this.fnShowLoginFailureMessage(b)}void 0!==a.profiles?this.fnFindValidProfileName(a.profiles):(this.sessionData.firstname="NA",this.sessionData.lastname="NA"),this.lastRes.valid=!0,this.fnResume_processCurrentForm()},fnFindValidProfileName:function(a){for(var b=0,c=null,d=0;d<a.length;d++)(null===c||c>parseInt(a[d].merch_id,10))&&(b=d,c=parseInt(a[d].merch_id,10));this.sessionData.firstname=a[b].firstname,this.sessionData.lastname=a[b].lastname},fnReqFail_verifyLogin:function(){this.lastRes=null,this.isBusy=!1,$("#f2B_email").attr("data-valid","false"),$("#f2B_pass").attr("data-valid","false"),this.fnTriggerPopup_bxLang("suv2_err_03","suv2_err_04")},fnAction_onContinue:function(a){setTimeout(rWiz.fnProcessCurrentForm(),1)},fnProcessCurrentForm:function(){if(!0!==this.isBusy){this.isBusy=!0;var a=this.fnGetActiveForm();__8trk__.signupPriority(1,"Form Submit","ID: "+a);var b=this.fnGetFormValuesByID(a);if("pending"!=b.valid)return null===b.nextID?void(!1===b.valid&&(this.isBusy=!1)):void this.fnProcessCurrentForm_partII(b)}},fnResume_processCurrentForm:function(){var a=this.lastRes;this.lastRes=null,this.fnProcessCurrentForm_partII(a)},fnProcessCurrentForm_partII:function(a){if(!0!==a.valid)return void(this.isBusy=!1);if(a.nextID,"form_biz_addr"==a.nextID&&!0!==a.searchComplete&&""!==this.sessionData.phone)return a.valid="pending",this.lastRes=a,delete this.lastRes.searchComplete,void this.fnLookupBizMatch(this.sessionData.phone);this.b_isEdit=!1,$(".form_item").attr("data-active","false");var b=this.fnGet_nextStep(a.nextID);null!==b&&($("#"+a.stepID).attr("data-active","standby"),this.curStepID=b),setTimeout(delegate(this,this.fnHandler_formSubmit,[a]),500)},fnUpdateValues_bizAddrForm:function(){__i18n__.fnVerifyCC_isSupported(this.sessionData.country)&&$("#f3_country").select2("val",this.sessionData.country),this.fnUpdateForm_stateProv()},fnPreUpdate_bizAddrForm:function(){if($("#f3_biz_phone").val(this.sessionData.phone),null!==this.findBizList&&void 0!==this.findBizList){var a=this.findBizList.length;if(a<1)return void $("#biz_found_box").attr("data-active","false");1===a?($("#f2_biz_count").text(""),$("#f2_biz_count_label").empty().append(" "+utlWrpSpanByBxLangClass("suv2_35_b","fx_fnt_18")),$(".biz_control").css("display","none")):($("#f2_biz_count").text(a),$("#f2_biz_count_label").empty().append(" "+utlWrpSpanByBxLangClass("suv2_35","fx_fnt_18")),$(".biz_control").css("display","block")),$("#biz_found_box").attr("data-active","true"),this.showBizByIdx(0)}},showNextBiz:function(){if(!0===this.b_isEdit){var a=delegate(this,function(){this.b_isEdit=!1,this.showNextBiz()},[]);return void this.fnOnBeforeChange_notify(a)}this.b_isEdit=!1,__8trk__.signupPriority(4,"Click","Show Next Biz"),this.findBizList.length<2||(this.curIdx++,this.curIdx>=this.findBizList.length&&(this.curIdx=0),this.showBizByIdx(this.curIdx))},showPrevBiz:function(){if(__8trk__.signupPriority(4,"Click","Show Previous Biz"),!0===this.b_isEdit){var a=delegate(this,function(){this.b_isEdit=!1,this.showPrevBiz()},[]);return void this.fnOnBeforeChange_notify(a)}this.b_isEdit=!1,this.findBizList.length<2||(this.curIdx--,this.curIdx<0&&(this.curIdx=this.findBizList.length-1),this.showBizByIdx(this.curIdx))},showBizByIdx:function(a){if(void 0!==this.findBizList[a]){this.curIdx=a,this.findBizList.length>1?$("#f2_biz_count").text(a+1+" / "+this.findBizList.length):$("#f2_biz_count").text(a+1);var b=this.findBizList[a];if(void 0!==b.address&&null!==b.address&&$("#f3_addr1").val(b.address),void 0!==b.biz_name&&null!==b.biz_name&&$("#f3_biz_name").val(b.biz_name),void 0!==b.city&&null!==b.city&&$("#f3_city").val(b.city),void 0!==b.country_code&&null!==b.country_code)if(b.country_code=(""+b.country_code).toLocaleUpperCase(),__i18n__.fnVerifyCC_isSupported(b.country_code)){$("#f3_country").select2("val",b.country_code);var c=void 0!==b.prov_state_code&&null!==b.prov_state_code&&""!==b.prov_state_code?b.prov_state_code:void 0;this.fnUpdateForm_stateProv(b.country_code,c)}else $("#f3_country").select2("val",0);void 0!==b.pczip&&null!==b.pczip&&$("#f3_postal").val(b.pczip),$("#f3_biz_name").attr("data-valid","true"),$("#f3_postal").attr("data-valid","true"),$("#f3_city").attr("data-valid","true"),$("#f3_addr1").attr("data-valid","true"),$("#f3_addr2").attr("data-valid","true")}},clearBizAddr:function(){__8trk__.signupPriority(4,"Click","Clear Biz Address"),$("#f3_biz_name").val(""),$("#f3_biz_type").val(""),$("#f3_postal").val(""),$("#f3_city").val(""),$("#f3_addr1").val(""),$("#f3_addr2").val(""),!0===__i18n__.b_supportedCC?($("#f3_country").select2("val",__i18n__.currentCC),this.fnUpdateForm_stateProv(__i18n__.currentCC)):($("#f3_country").select2("val",0),this.fnUpdateForm_stateProv())},fnHandler_formSubmit:function(a){if(!0!==a.valid)return void(this.isBusy=!1);var b=0;if(null!==a.cardID&&void 0!==a.cardID){switch(a.cardID){case"card_new_biz":b+=this.fnUpdateCard_new_biz()||500;break;case"card_biz_addr":b+=this.fnUpdateCard_biz_addr()||500;break;case"card_staff_new":b+=this.fnUpdateCard_new_staff()||500}$("#"+a.cardID).attr("data-active","true")}if(null!==a.nextID&&void 0!==a.nextID){switch(this.sessionData.progress=this.cfg[a.nextID].progress,a.nextID){case"form_biz_addr":this.fnPreUpdate_bizAddrForm()}setTimeout(function(){$("#"+a.nextID).parent().attr("data-active","true")},b)}var c=this.fnGet_nextStep(a.nextID);if(null!==a.nextID){var d=this.cfg[a.nextID].progress;if(3==d||5==d){var e="create_account"==this.accountMode?"suv2_67":"suv2_68";$("#btn_form_continue").empty().append(utlWrpSpanByBxLangClass(e,"fx_fnt_16 tx_shad_2"))}else $("#btn_form_continue").empty().append(utlWrpSpanByBxLangClass("suv2_31","fx_fnt_16 tx_shad_2"))}null!==c&&("form_new_biz"==c||"form_biz_login"==c||"form_staff_new"==c?$("#mob_staff_invite_option").css("display","block"):$("#mob_staff_invite_option").css("display","none"),$(".step_block").attr("data-active","false"),$("#"+c).attr("data-active","standby"),$("#mobile_"+c).attr("data-active","standby"),setTimeout(function(){$("#"+c).attr("data-active","true"),$("#mobile_"+c).attr("data-active","true")},b)),this.fnLog_flowProgress(),this.fnRepostionVPos(),this.isBusy=!1},fnUpdateCard_new_biz:function(){var a="";a+=null!==this.sessionData.firstname?this.sessionData.firstname:"",a+=a.length>0?" ":"",a+=null!==this.sessionData.lastname?this.sessionData.lastname:"",0===a.length&&(a=utlBxLang("suv2_78")),$("#label_signup_name").text(a),$("#label_signup_email").text(this.sessionData.email)},fnUpdateCard_biz_addr:function(){$("#label_biz_name").text(this.sessionData.biz_name),$("#label_phone").text(this.sessionData.phone);var a=this.sessionData.address+(null!==this.sessionData.address_line2?" "+this.sessionData.address_line2:"");$("#label_addr1").text(a);var b="";b+=this.sessionData.pczip,b+=b.length>0?", ":"",b+=this.sessionData.city,!0===this.b_isReq_stateProv&&(b+=b.length>0?", ":"",b+=this.sessionData.provstate),$("#label_addr2").text(b)},fnUpdateCard_new_staff:function(){$("#label_staff_name").text(utlBxLang("suv2_24")),$("#label_staff_email").text(this.sessionData.email),$("#label_invite_code").text(this.sessionData.personnel_code),$("#label_invite_email").text(this.sessionData.invite_email),$("#label_invite_biz_name").text(this.ds_inviteData.merchant)},fnGetFormValuesByID:function(a){if(void 0===this.cfg[a])return{valid:!1,formID:null,stepID:null,nextID:null,cardID:null};var b={valid:!0,formID:this.cfg[a].formID,stepID:this.cfg[a].stepID,nextID:this.cfg[a].nextID,cardID:this.cfg[a].cardID};switch(a){case"form_new_biz":b=this.fnFormHandler_new_biz(b);break;case"form_biz_login":b=this.fnFormHandler_biz_login(b);break;case"form_biz_addr":b=this.fnFormHandler_biz_addr(b);break;case"form_biz_done":b=this.fnFormHandler_biz_done(b);break;case"form_staff_new":b=this.fnFormHandler_staff_new(b);break;case"form_staff_done":b=this.fnFormHandler_staff_done(b)}return b},fnFormHandler_new_biz:function(a){var b=$("#f2A_country"),c=$("#f2A_fname"),d=$("#f2A_lname"),e=$("#f2A_email"),f=$("#f2A_pass"),g=$("#f2A_biz_phone");c.val(c.val().trim()),d.val(d.val().trim()),e.val(e.val().trim());var h={valid:a.valid,formID:a.formID,stepID:a.stepID,nextID:a.nextID,cardID:a.cardID,f2A_country:b.val()||!1,f2A_fname:c.val()||!1,f2A_lname:d.val()||!1,f2A_email:e.val()||!1,f2A_pass:f.val()||!1,f2A_biz_phone:g.val()||!1},i=[];if(!1===h.f2A_country||""===h.f2A_country?(h.valid=!1,b.attr("data-valid","false"),i.push("f2A_country")):(b.attr("data-valid","true"),this.sessionData.country=h.f2A_country,$("#f3_country").select2("val",this.sessionData.country),this.fnUpdateForm_stateProv(this.sessionData.country)),!1===h.f2A_fname||""===h.f2A_fname?(h.valid=!1,c.attr("data-valid","false"),i.push("f2A_fname")):(c.attr("data-valid","true"),this.sessionData.firstname=h.f2A_fname),!1===h.f2A_lname||""===h.f2A_lname?(h.valid=!1,d.attr("data-valid","false"),i.push("f2A_lname")):(d.attr("data-valid","true"),this.sessionData.lastname=h.f2A_lname),!1===h.f2A_email||""===h.f2A_email||!1===regex.email.test(h.f2A_email)?(h.valid=!1,e.attr("data-valid","false"),i.push("f2A_email")):(e.attr("data-valid","true"),this.sessionData.email=h.f2A_email),!1===h.f2A_pass||""===h.f2A_pass||h.f2A_pass.length<6?(h.valid=!1,f.attr("data-valid","false"),i.push("f2A_pass")):(f.attr("data-valid","true"),this.sessionData.password=h.f2A_pass),!1===h.f2A_biz_phone||""===h.f2A_biz_phone)this.sessionData.phone="";else{var j=__i18n__.fnValidateFormatPhone(h.f2A_biz_phone,this.sessionData.country);!1!==j?(g.val(j),this.sessionData.phone=j,g.attr("data-valid","true")):(h.valid=!1,g.attr("data-valid","false"),i.push("f2A_biz_phone"))}if(!0===h.valid){this.sessionData.progress_type="business creation",this.accountMode="create_account",this.lastRes=h,h.valid="pending",this.sessionData.progress=0,this.fnLog_flowProgress(this.sessionData.email),this.fnLookup_emailUsed(h.f2A_email),"true"==g.attr("data-valid")&&""!==this.sessionData.phone&&this.fnLookup_bizPhoneUsed(this.sessionData.phone,h.f2A_country);var k={firstname:this.sessionData.firstname,lastname:this.sessionData.lastname,email:this.sessionData.email,country:$("#f2A_country :selected").text()};null!==this.sessionData.phone&&""!==this.sessionData.phone&&(k.phone=this.sessionData.phone);var l=__fancy_path__+"web_php/svr/put_record_client_hub.php";dc.fnAjax_standalone(l,k,"POST",function(){},function(){}),__8trk__.mxpTrack("SU step1",{type:"new business"})}else __8trk__.signupPriority(2,"Form Validation Error","ID: "+h.formID+" Error: "+i.toString());return h},fnFormHandler_biz_login:function(a){var b=$("#f2B_country"),c=$("#f2B_email"),d=$("#f2B_pass"),e=$("#f2B_biz_phone");c.val(c.val().trim());var f={valid:a.valid,formID:a.formID,stepID:a.stepID,nextID:a.nextID,cardID:a.cardID,f2B_country:b.val()||!1,f2B_email:c.val()||!1,f2B_pass:d.val()||!1,f2B_biz_phone:e.val()||!1},g=[];if(!1===f.f2B_country||""===f.f2B_country?(f.valid=!1,b.attr("data-valid","false"),g.push("f2B_country")):(this.sessionData.country=f.f2B_country,$("#f3_country").select2("val",this.sessionData.country),this.fnUpdateForm_stateProv(this.sessionData.country)),!1===f.f2B_email||""===f.f2B_email||!1===regex.email.test(f.f2B_email)?(f.valid=!1,c.attr("data-valid","false"),g.push("f2B_email")):(c.attr("data-valid","true"),this.sessionData.email=f.f2B_email),!1===f.f2B_pass||""===f.f2B_pass?(f.valid=!1,d.attr("data-valid","false"),g.push("f2B_pass")):(d.attr("data-valid","true"),this.sessionData.password=f.f2B_pass),!1===f.f2B_biz_phone||""===f.f2B_biz_phone)this.sessionData.phone="";else{var h=__i18n__.fnValidateFormatPhone(f.f2B_biz_phone,this.sessionData.country);!1!==h?(e.val(h),this.sessionData.phone=h,e.attr("data-valid","true")):(f.valid=!1,e.attr("data-valid","false"),g.push("f2B_biz_phone"))}return!0===f.valid?(this.sessionData.progress_type="business creation",this.accountMode="existing_account",this.lastRes=f,f.valid="pending",this.sessionData.progress=1,this.fnLog_flowProgress(this.sessionData.email),this.fnVerifyLogin(f.f2B_email,f.f2B_pass),"true"==e.attr("data-valid")&&""!==this.sessionData.phone&&this.fnLookup_bizPhoneUsed(this.sessionData.phone),this.fnHubFormSubmit("hub_form_1B",{email:this.sessionData.email,phone:null!==this.sessionData.phone?this.sessionData.phone:"",country:$("#f2B_country :selected").text(),country_code:this.sessionData.country}),__8trk__.mxpTrack("SU step1",{type:"new profile"})):__8trk__.signupPriority(2,"Form Validation Error","ID: "+f.formID+" Error: "+g.toString()),f},fnFormHandler_biz_addr:function(a){var b=$("#f3_biz_name"),c=$("#f3_biz_type"),d=$("#f3_country"),e=$("#f3_stateprov"),f=$("#f3_biz_phone"),g=$("#f3_postal"),h=$("#f3_city"),i=$("#f3_addr1"),j=$("#f3_addr2");b.val(b.val().trim()),g.val(g.val().trim()),h.val(h.val().trim()),i.val(i.val().trim()),j.val(j.val().trim());var k={valid:a.valid,formID:a.formID,stepID:a.stepID,nextID:a.nextID,cardID:a.cardID,f3_biz_name:b.val()||!1,f3_biz_type:c.val()||!1,f3_country:d.val()||!1,f3_stateprov:e.val()||!1,f3_biz_phone:f.val()||!1,f3_postal:g.val()||"",f3_city:h.val()||"",f3_addr1:i.val()||"",f3_addr2:j.val()||""},l=[];if(!1===k.f3_biz_name||""===k.f3_biz_name?(k.valid=!1,b.attr("data-valid","false"),l.push("f3_biz_name")):(b.attr("data-valid","true"),this.sessionData.biz_name=k.f3_biz_name),!1===k.f3_biz_type||""===k.f3_biz_type||"-1"==k.f3_biz_type?(k.valid=!1,c.attr("data-valid","false"),l.push("f3_biz_type")):(c.attr("data-valid","true"),this.sessionData.segment=$("#f3_biz_type :selected").text(),this.sessionData.seg_id=k.f3_biz_type),!1===k.f3_country||""===k.f3_country?(k.valid=!1,d.attr("data-valid","false"),l.push("f3_country")):(d.attr("data-valid","true"),this.sessionData.country=k.f3_country),!1!==k.f3_stateprov&&""!==k.f3_stateprov||!0!==this.b_isReq_stateProv?!0===this.b_isReq_stateProv?this.sessionData.provstate=k.f3_stateprov:this.sessionData.provstate="":(k.valid=!1,e.attr("data-valid","false"),l.push("f3_stateprov")),""===k.f3_city?this.sessionData.city="":(h.attr("data-valid","true"),this.sessionData.city=k.f3_city),""===k.f3_addr1?this.sessionData.address="":(i.attr("data-valid","true"),this.sessionData.address=k.f3_addr1),""===k.f3_addr2?this.sessionData.address_line2="":(j.attr("data-valid","true"),this.sessionData.address_line2=k.f3_addr2),""===k.f3_postal)g.attr("data-valid","true"),this.sessionData.pczip="";else{var m=(""+k.f3_postal).toUpperCase();m=m.trim(),__i18n__.fnValidatePostalByCC(this.sessionData.country,m)?(g.val(m),this.sessionData.pczip=m,g.attr("data-valid","true")):(k.valid=!1,g.attr("data-valid","false"),l.push("f3_postal"))}if(!1===k.f3_biz_phone||""===k.f3_biz_phone)this.sessionData.phone="";else{var n=__i18n__.fnValidateFormatPhone(k.f3_biz_phone,this.sessionData.country);!1!==n?(f.val(n),this.sessionData.phone=n,f.attr("data-valid","true")):(k.valid=!1,f.attr("data-valid","false"),l.push("f3_biz_phone"))}if(k.valid){this.sessionData.progress_type="business creation",this.sessionData.progress=2,this.fnLog_flowProgress(this.sessionData.email);var o=k.f3_addr1+" ";o+=k.f3_city+" ",!0===this.b_isReq_stateProv&&(o+=k.f3_stateprov+" "),o+=k.f3_postal+" ",o+=k.f3_country;var p={email:this.sessionData.email,company:this.sessionData.biz_name,industry:this.sessionData.segment,country:$("#f3_country :selected").text()};!0===this.b_isReq_stateProv&&(p.state=$("#f3_stateprov :selected").text()),null!==this.sessionData.phone&&""!==this.sessionData.phone&&(p.phone=this.sessionData.phone),null!==this.sessionData.address&&""!==this.sessionData.phone&&(p.address=this.sessionData.address),null!==this.sessionData.city&&""!==this.sessionData.phone&&(p.city=this.sessionData.city);var q=__fancy_path__+"web_php/svr/update_record_client_hub.php";dc.fnAjax_standalone(q,p,"POST",function(){},function(){}),__8trk__.mxpTrack("SU step2")}else __8trk__.signupPriority(2,"Form Validation Error","ID: "+k.formID+" Error: "+l.toString());return k},fnUpdate_packageDropDown:function(){},fnFormHandler_biz_done:function(a){var b={valid:a.valid,formID:a.formID,stepID:a.stepID,nextID:a.nextID,cardID:a.cardID},c=[],d=$("#f3_biz_terms"),e=$("#f3_biz_promo");return d.is(":checked")?(d.parent().attr("data-valid","true"),$("#form_biz_done").find(".terms_box").attr("data-valid","true")):(b.valid=!1,d.parent().attr("data-valid","false"),$("#form_biz_done").find(".terms_box").attr("data-valid","false"),c.push("f3_biz_terms")),""!==e.val()&&null===this.ds_promo?(b.valid=!1,this.fnPromoCodeHandler(),c.push("f3_biz_promo")):e.attr("data-valid","true"),!0===b.valid?(this.sessionData.progress_type="business creation",this.sessionData.progress=3,this.fnLog_flowProgress(this.sessionData.email),this.fnPerform_businessSignup(),__8trk__.mxpTrack("SU step3",{type:"business registered"})):__8trk__.signupPriority(2,"Form Validation Error","ID: "+b.formID+" Error: "+c.toString()),b},fnFormHandler_staff_new:function(a){var b=$("#f1_email"),c=$("#f1_pass"),d=$("#f1_inv_email"),e=$("#f1_inv_code");b.val(b.val().trim()),c.val(c.val().trim()),d.val(d.val().trim()),e.val(e.val().trim());var f={valid:a.valid,formID:a.formID,stepID:a.stepID,nextID:a.nextID,cardID:a.cardID,f1_email:b.val()||!1,f1_pass:c.val()||!1,f1_inv_email:d.val()||!1,f1_inv_code:e.val()||!1},g=[];return!1===f.f1_email||""===f.f1_email||!1===regex.email.test(f.f1_email)?(f.valid=!1,b.attr("data-valid","false"),g.push("f1_email")):(b.attr("data-valid","true"),this.sessionData.email=f.f1_email),!1===f.f1_pass||""===f.f1_pass||f.f1_pass.length<6?(f.valid=!1,c.attr("data-valid","false"),g.push("f1_pass")):(c.attr("data-valid","true"),this.sessionData.password=f.f1_pass),!1===f.f1_inv_email||""===f.f1_inv_email||!1===regex.email.test(f.f1_inv_email)?(f.valid=!1,d.attr("data-valid","false"),g.push("")):(d.attr("data-valid","true"),this.sessionData.invite_email=f.f1_inv_email),!1===f.f1_inv_code||""===f.f1_inv_code?(f.valid=!1,e.attr("data-valid","false"),g.push("f1_inv_email")):(e.attr("data-valid","true"),this.sessionData.personnel_code=f.f1_inv_code),!0===f.valid?(this.sessionData.progress_type="personnel sign-up",this.accountMode="create_account",this.lastRes=f,f.valid="pending",this.sessionData.progress=4,this.fnLog_flowProgress(this.sessionData.email),this.fnVerifyStaffInvite(f.f1_inv_email,f.f1_inv_code),__8trk__.mxpTrack("SU step1",{type:"staff invite"})):__8trk__.signupPriority(2,"Form Validation Error","ID: "+f.formID+" Error: "+g.toString()),f},fnFormHandler_staff_done:function(a){var b={valid:a.valid,formID:a.formID,stepID:a.stepID,nextID:a.nextID,cardID:a.cardID},c=[],d=$("#f3_staff_terms");return d.is(":checked")?d.parent().attr("data-valid","true"):(b.valid=!1,d.parent().attr("data-valid","false"),$("#form_staff_done").find(".terms_box").attr("data-valid","false"),c.push("f2_staff_terms")),!0===b.valid?(this.sessionData.progress_type="personnel sign-up",this.fnPerform_staffSignup(),this.sessionData.progress=5,this.fnLog_flowProgress(this.sessionData.email),__8trk__.mxpTrack("SU step2",{type:"staff registered"})):__8trk__.signupPriority(2,"Form Validation Error","ID: "+b.formID+" Error: "+c.toString()),b},fnTriggerPopup_text:function(a,b){core.fnShowGPopup({masterClass:"globalPopup",title_text:utlWrpSpan(a),text:utlWrpSpan(b),btn1_text:utlWrpSpanByBxLang("com_button_03")})},fnTriggerPopup_bxLang:function(a,b){core.fnShowGPopup({masterClass:"globalPopup",title_text:utlWrpSpanByBxLang(a),text:utlWrpSpanByBxLang(b),btn1_text:utlWrpSpanByBxLang("com_button_03")})},fnHandler_addressVerification:function(a){},fnPerform_businessSignup:function(){var a="",b="";$("#su_ovr_loading").attr("data-show","true");var c={firstname:this.sessionData.firstname,lastname:this.sessionData.lastname,phone:formatE164(this.sessionData.country,this.sessionData.phone),seg_id:this.sessionData.seg_id,segment:this.sessionData.segment,biz_name:this.sessionData.biz_name,country:this.sessionData.country,address:this.sessionData.address,city:this.sessionData.city,prov_state:this.sessionData.provstate,pczip:this.sessionData.pczip,ypg_id:"",gRef:"",longitude:a,latitude:b,account_mode:this.accountMode,email:utlTrimWhiteSpace_edge(this.sessionData.email,!0),password:this.sessionData.password,promocode_id:""};if(null!==this.sessionData.address_line2&&(c.address+=" "+this.sessionData.address_line2),null!==this.ds_promo){if(null!==this.ds_promo.expiresOn&&void 0!==this.ds_promo.expiresOn){var d=new Date,e=moment.utc(this.ds_promo.expiresOn),f=e.local().toDate();if(d.getTime()>f.getTime())return void this.fnHandle_promoExpired()}c.promocode_id=this.ds_promo.promocodeId}this.flag_signUpStaff=!1,__8trk__.signupPriority(0,"Register Business",this.accountMode),dc.s(this.dc_session,"_regWiz_fnReq_registerBusiness",[c,delegate(this,this.fnReqSuccess_register_forBiz,[]),delegate(this,this.fnReqFail_register,[])])},fnPerform_staffSignup:function(){$("#su_ovr_loading").attr("data-show","true");var a={account_mode:this.accountMode,email:utlTrimWhiteSpace_edge(this.sessionData.email,!0),password:this.sessionData.password,invite_id:this.ds_inviteData.invite_id};this.flag_signUpStaff=!0,__8trk__.signupPriority(0,"Register Staff","Email: "+utlTrimWhiteSpace_edge(this.sessionData.email,!0)),dc.s(this.dc_session,"_regWiz_fnReq_registerStaff",[a,delegate(this,this.fnReqSuccess_register,[]),delegate(this,this.fnReqFail_register,[])])},fnReqSuccess_register:function(){this.fnTriggerComplete()},fnReqSuccess_register_forBiz:function(a){if(void 0!==arguments[0]&&0!==utlAsInt_nullOnNaN(a.result))return void this.fnReqFail_register(a);this.fnLogIntercom();var b={email:this.sessionData.email},c=__fancy_path__+"web_php/svr/complete_record_client_hub.php";dc.fnAjax_standalone(c,b,"POST",delegate(this,this.fnReqHub_complete,[]),delegate(this,this.fnReqHub_complete,[]))},fnReqHub_complete:function(){this.fnTriggerComplete()},fnReqFail_register:function(a){var b=null;void 0!==arguments[0]&&void 0!==a.reason&&(b=a.reason),__8trk__.signupPriority(0,"Registration Request Failed","");var c="suv2_76";if(null!==b){var d=parseInt(b,10);isNaN(d)||(d=d<0?-1*d:d,void 0!==lang["reason_"+d]&&(c="reason_"+d))}dc.serverLogV2("SIGNUP_PROBLEM","LOG_WARNING","signup.js","fnReqFail_register","Server refused the signup request, reason code ("+b+")"),$("#su_ovr_loading").attr("data-show","false"),core.fnShowGPopup({masterClass:"globalPopup",title_text:utlWrpSpanByBxLang("suv2_75"),text:utlWrpSpanByBxLang(c),btn1_text:utlWrpSpanByBxLang("com_button_03")}),this.isBusy=!1},fnLog_byType:function(a){var b=a.val();void 0!==b&&null!==b&&""!==b||(b=this.sessionData.email),this.fnLog_flowProgress(b)},fnLog_flowProgress:function(a){if(void 0!==a&&null!==a&&""!==a){var b={email:utlTrimWhiteSpace_edge(a,!0)};null!==this.sessionData.firstname&&(b.firstname=utlTrimWhiteSpace_edge(this.sessionData.firstname,!0)),null!==this.sessionData.lastname&&(b.lastname=utlTrimWhiteSpace_edge(this.sessionData.lastname,!0)),null!==this.sessionData.phone&&(b.phone=utlTrimWhiteSpace_edge(this.sessionData.phone,!0)),null!==this.sessionData.biz_name&&(b.biz_name=utlTrimWhiteSpace_edge(this.sessionData.biz_name,!0)),null!==this.sessionData.segment&&(b.segment=this.sessionData.segment),null!==this.sessionData.seg_id&&(b.seg_id=this.sessionData.seg_id),null!==this.sessionData.pczip&&(b.pczip=utlTrimWhiteSpace_edge(this.sessionData.pczip,!0)),null!==this.sessionData.address&&(b.address=utlTrimWhiteSpace_edge(this.sessionData.address,!0)),null!==this.sessionData.address_line2&&(b.address=utlTrimWhiteSpace_edge(b.address+" "+this.sessionData.address_line2,!0)),null!==this.sessionData.city&&(b.city=utlTrimWhiteSpace_edge(this.sessionData.city,!0)),null!==this.sessionData.provstate&&(b.provstate=this.sessionData.provstate),null!==this.sessionData.country&&(b.country=this.sessionData.country),null!==this.sessionData.progress&&(b.progress=this.sessionData.progress),null!==this.sessionData.promocode&&(b.promocode=this.sessionData.promocode),null!==this.sessionData.personnel_code&&(b.personnel_code=this.sessionData.personnel_code),null!==this.sessionData.progress_type&&(b.progress_type=this.sessionData.progress_type);var c=core.fnCK_readCookie("_bxref");void 0!==c&&(b.partner_ref_id=c),dc.s(this.dc_session,"_regWiz_fnReq_saveSignupProgress",[b])}},fnTriggerComplete:function(){$("#su_ovr_loading").attr("data-show","false"),core.fnCK_writeCookie("rWiz_isStaff",""+this.flag_signUpStaff,1),core.fnCK_writeCookie("rWiz_firstname",this.sessionData.firstname,1),core.fnCK_writeCookie("rWiz_accountMode",this.accountMode,1),__8trk__.signupPriority(0,"Registration Complete"),window.location=fnLang_getBxLink("signup_complete")},fnTriggerComplete_old:function(){if(!0===window.__rWis_redirect)return core.fnCK_writeCookie("rWiz_firstname",this.sessionData.firstname,1),core.fnCK_writeCookie("rWiz_accountMode",this.accountMode,1),__8trk__.signupPriority(0,"Registration Complete","From Facebook Ad"),void(window.location=fnLang_getBxLink("signup_complete"));if(window.scrollTo(0,0),__8trk__.b_isCampaign){var a=__8trk__.ds_campaign,b="";b+=void 0!==a.campaign?"Campaign: "+a.campaign:"",b+=void 0!==a.source?" Source: "+a.source:"",__8trk__.signupPriority(0,"Registration Complete",b)}else __8trk__.signupPriority(0,"Registration Complete");var c="new_biz_success",d=this.sessionData.firstname+utlBxLang(""),e=utlBxLang("suv2_70");"existing_account"==this.accountMode&&(c="biz_success",d=utlBxLang("suv2_73"),e=utlBxLang("suv2_74")),"personnel sign-up"==this.sessionData.progress_type&&(c="staff_success",d=utlBxLang("suv2_73"),e=utlBxLang("suv2_74")),$("#tx_title_complete").empty().append(utlWrpSpan(d,"tx_type_S")),$("#tx_text_complete").empty().append(utlWrpSpan(e,"tx_type_A")),$("#img_banner_complete").attr("data-img-status",c),$(".signup_box").css("display","none"),$(".complete_box").css("display","block")},fnRepostionVPos:function(){var a=$(".signup_box").eq(0).offset().top;window.scrollTo(0,a)},fnxClickCheck:function(a,b){var c=$(a).find("input").eq(0);c.trigger("click");var d=c.prop("checked")||"true"!==c.parent().attr("is_req")?"true":"false";c.parent().attr("data-valid",d),$(a).parent().parent().parent().attr("data-valid",d)},fnh_notEmpty:function(a){return void 0!==a&&null!==a&&""!==a&&(!0!==utlIsVarString(a)||""!==utlTrimWhiteSpace_edge(a))},fnLogIntercom:function(){if(void 0!==window.Intercom&&!1!==this.fnh_notEmpty(this.sessionData.email)){var a={email:this.sessionData.email,user_agent_data:navigator.userAgent,bx_origin:"SIGN-UP",Language:core.defLang},b=Intercom("getVisitorId");""!==b&&void 0!==b&&null!==b&&(a.id=b);var c=document.referrer;""!==c&&void 0!==c&&null!==c&&-1==utlAsString(c).search("www.booxi.com")&&(a.bx_referrer=c),!0===this.fnh_notEmpty(this.sessionData.firstname)&&!0===this.fnh_notEmpty(this.sessionData.lastname)&&(a.name=this.sessionData.firstname+" "+this.sessionData.lastname),!0===this.fnh_notEmpty(this.sessionData.phone)&&(a.phone=this.sessionData.phone),!0===this.fnh_notEmpty(this.sessionData.progress)&&(a.signup_progress=utlAsInt(this.sessionData.progress)>2?"complete":"in_progress"),!0===this.fnh_notEmpty(this.sessionData.segment)&&(a.signup_val_segment=this.sessionData.segment),!0===this.fnh_notEmpty(this.sessionData.biz_name)&&(a.signup_val_biz_name=this.sessionData.biz_name);var d=null;!0===this.fnh_notEmpty(this.sessionData.country)&&(d={type:"location_data",country_code:this.sessionData.country},!0===this.fnh_notEmpty(this.sessionData.city)&&(d.city_name=this.sessionData.city),!0===this.fnh_notEmpty(this.sessionData.pczip)&&(d.postal_code=this.sessionData.pczip)),null!==d&&(a.location_data=d),Intercom("update",a)}},fnHubFormSubmit:function(a,b){},end:null});window.rWiz=new rWizard;